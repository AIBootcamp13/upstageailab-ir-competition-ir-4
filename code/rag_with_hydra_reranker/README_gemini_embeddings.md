# Gemini ì„ë² ë”© ë°°ì¹˜ë³„ ìƒì„± ê°€ì´ë“œ

Gemini APIì˜ ì¼ì¼ ì œí•œëŸ‰ìœ¼ë¡œ ì¸í•´ ì „ì²´ ë¬¸ì„œ ì„ë² ë”©ì„ í•œ ë²ˆì— ì²˜ë¦¬í•˜ê¸° ì–´ë ¤ìš¸ ë•Œ ì‚¬ìš©í•˜ëŠ” ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

## ğŸ¯ ì£¼ìš” ê¸°ëŠ¥

- **ë°°ì¹˜ë³„ ì €ì¥**: ê° ë°°ì¹˜ ì™„ë£Œ ì‹œë§ˆë‹¤ ê²°ê³¼ë¥¼ íŒŒì¼ì— ì €ì¥
- **ì´ì–´ë°›ê¸°**: ì¤‘ë‹¨ëœ ì§€ì ë¶€í„° ë‹¤ì‹œ ì‹œì‘
- **ì˜¤ë¥˜ ì²˜ë¦¬**: API ì œí•œ ë„ë‹¬ ì‹œ ìš°ì•„í•œ ì¢…ë£Œ
- **ì§„í–‰ìƒí™© ì¶”ì **: ì‹¤ì‹œê°„ ì§„í–‰ìƒí™© ë° ì˜ˆìƒ ì‹œê°„ í‘œì‹œ

## ğŸ“ ì €ì¥ êµ¬ì¡°

```
gemini_embeddings/
â”œâ”€â”€ metadata.json          # ì§„í–‰ìƒí™©, ì„¤ì • ì •ë³´
â”œâ”€â”€ batch_0000.npy        # ì²« ë²ˆì§¸ ë°°ì¹˜ ì„ë² ë”©
â”œâ”€â”€ batch_0001.npy        # ë‘ ë²ˆì§¸ ë°°ì¹˜ ì„ë² ë”©
â”œâ”€â”€ ...
â””â”€â”€ all_embeddings.npy    # ëª¨ë“  ë°°ì¹˜ ë³‘í•©ëœ ìµœì¢… íŒŒì¼ (ì™„ë£Œ í›„)
```

## ğŸš€ ì‚¬ìš© ë°©ë²•

### 1. Gemini ì„ë² ë”© ìƒì„± ì‹œì‘

```bash
cd /root/dev/upstageailab-ir-competition-ir-4/code/rag_with_hydra_reranker
python gemini_embedding_generator.py
```

### 2. ì œí•œ ë„ë‹¬ ì‹œ ìë™ ì¤‘ë‹¨

API ì œí•œì— ë„ë‹¬í•˜ë©´ ìë™ìœ¼ë¡œ ì¤‘ë‹¨ë˜ê³  í˜„ì¬ê¹Œì§€ì˜ ì§„í–‰ìƒí™©ì´ ì €ì¥ë©ë‹ˆë‹¤:

```
âš ï¸  Rate limit ë˜ëŠ” quota ë„ë‹¬ë¡œ ì¤‘ë‹¨ë¨: ...
ğŸ“Š í˜„ì¬ê¹Œì§€ 15ê°œ ë°°ì¹˜ ì™„ë£Œ
ğŸ’¡ ì œí•œ í•´ì œ í›„ ë™ì¼í•œ ëª…ë ¹ìœ¼ë¡œ ë‹¤ì‹œ ì‹¤í–‰í•˜ì‹œë©´ ì´ì–´ì„œ ì§„í–‰ë©ë‹ˆë‹¤.
```

### 3. ë‹¤ìŒë‚  ì´ì–´ì„œ ì‹¤í–‰

ë™ì¼í•œ ëª…ë ¹ì„ ë‹¤ì‹œ ì‹¤í–‰í•˜ë©´ ìë™ìœ¼ë¡œ ì¤‘ë‹¨ëœ ì§€ì ë¶€í„° ê³„ì†ë©ë‹ˆë‹¤:

```bash
python gemini_embedding_generator.py
```

ì¶œë ¥ ì˜ˆì‹œ:
```
ğŸ”„ ì„ë² ë”© ìƒì„± ì¬ê°œ: ë°°ì¹˜ 16ë¶€í„° ì‹œì‘ (ì´ 50ê°œ ë°°ì¹˜)
```

### 4. ì™„ë£Œ í›„ RAG ì‹œìŠ¤í…œ ì‹¤í–‰

ëª¨ë“  ì„ë² ë”© ìƒì„±ì´ ì™„ë£Œë˜ë©´ ê¸°ì¡´ RAG ì‹œìŠ¤í…œì„ ì‹¤í–‰í•©ë‹ˆë‹¤:

```bash
python rag_with_hybrid_reranker_es9.py
```

## âš™ï¸ ì„¤ì •

`conf/config.yaml`ì—ì„œ ë°°ì¹˜ ì„¤ì •ì„ ì¡°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```yaml
retrieve:
  dense_gemini:
    batch_size: 100              # í•œ ë²ˆì— ì²˜ë¦¬í•  ë¬¸ì„œ ìˆ˜
    batch_delay_seconds: 65      # ë°°ì¹˜ ê°„ ëŒ€ê¸° ì‹œê°„ (ì´ˆ)
```

## ğŸ“Š ì§„í–‰ìƒí™© í™•ì¸

ì§„í–‰ìƒí™©ì€ ì‹¤ì‹œê°„ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤:

```
[16/50] ì™„ë£Œ (32.0%) - ë°°ì¹˜ ì²˜ë¦¬ì‹œê°„: 45.2ì´ˆ, ì˜ˆìƒ ë‚¨ì€ì‹œê°„: 25.7ë¶„
```

`metadata.json` íŒŒì¼ì—ì„œë„ í˜„ì¬ ì§„í–‰ìƒí™©ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```json
{
  "last_completed_batch": 15,
  "total_documents": 5000,
  "total_batches": 50,
  "completed": false,
  "start_time": 1703123456.789
}
```

## ğŸ”§ ë¬¸ì œ í•´ê²°

### Q: ì„ë² ë”© íŒŒì¼ì´ ì†ìƒë˜ì—ˆë‚˜ìš”?

ê° ë°°ì¹˜ê°€ ê°œë³„ íŒŒì¼ë¡œ ì €ì¥ë˜ë¯€ë¡œ ì¼ë¶€ ë°°ì¹˜ë§Œ ì¬ìƒì„±í•˜ë©´ ë©ë‹ˆë‹¤. ì†ìƒëœ ë°°ì¹˜ íŒŒì¼ì„ ì‚­ì œí•˜ê³  ë‹¤ì‹œ ì‹¤í–‰í•˜ì„¸ìš”.

### Q: ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘í•˜ê³  ì‹¶ì–´ìš”

`gemini_embeddings/` í´ë”ë¥¼ ì‚­ì œí•˜ê³  ë‹¤ì‹œ ì‹¤í–‰í•˜ì„¸ìš”:

```bash
rm -rf gemini_embeddings/
python gemini_embedding_generator.py
```

### Q: ì§„í–‰ìƒí™©ì´ ì´ìƒí•´ìš”

`metadata.json`ì„ ì‚­ì œí•˜ë©´ ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘ë©ë‹ˆë‹¤:

```bash
rm gemini_embeddings/metadata.json
python gemini_embedding_generator.py
```

## ğŸ’¡ íŒ

1. **ë°°ì¹˜ í¬ê¸° ì¡°ì •**: API ì œí•œì— ìì£¼ ê±¸ë¦¬ë©´ `batch_size`ë¥¼ ì¤„ì—¬ë³´ì„¸ìš”
2. **ëŒ€ê¸° ì‹œê°„ ì¦ê°€**: `batch_delay_seconds`ë¥¼ ëŠ˜ë¦¬ë©´ ì œí•œì— ëœ ê±¸ë¦½ë‹ˆë‹¤
3. **ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰**: `nohup python gemini_embedding_generator.py &`ë¡œ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰ ê°€ëŠ¥

## ğŸ‰ ì™„ë£Œ í™•ì¸

ëª¨ë“  ì‘ì—…ì´ ì™„ë£Œë˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ë©”ì‹œì§€ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```
âœ… ëª¨ë“  ì„ë² ë”© ìƒì„± ì™„ë£Œ!
ğŸ“Š ì´ 5000ê°œ ë¬¸ì„œ, 50ê°œ ë°°ì¹˜, ì´ ì†Œìš”ì‹œê°„: 120.5ë¶„
ğŸ“ ë³‘í•© ì™„ë£Œ: 5000ê°œ ì„ë² ë”© -> gemini_embeddings/all_embeddings.npy
ğŸ‰ ëª¨ë“  ì‘ì—…ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!
```